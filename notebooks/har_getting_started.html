

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Getting Started with Minerva for Human Activity Recognition &mdash; minerva  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Minerva Experimental Pipeline" href="experiment_api_example.html" />
    <link rel="prev" title="Getting Started with Minerva for Seismic Facies Segmentation" href="seismic_facies_getting_started.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            minerva
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design.html">Minerva Design</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Examples and Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../tutorials.html#getting-started-notebooks">Getting Started Notebooks</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="seismic_facies_getting_started.html">Getting Started with Minerva for Seismic Facies Segmentation</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Getting Started with Minerva for Human Activity Recognition</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Imports">Imports</a></li>
<li class="toctree-l4"><a class="reference internal" href="#1.-Data-Preparation">1. Data Preparation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#2.-Creating-the-Model">2. Creating the Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#3.-Defining-the-trainer">3. Defining the trainer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#3.1.-Training-the-model">3.1. Training the model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#4.-Evaluating-Model">4. Evaluating Model</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="experiment_api_example.html">Minerva Experimental Pipeline</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing to Minerva</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">Programming Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">minerva</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../tutorials.html">Examples and Tutorials</a></li>
      <li class="breadcrumb-item active">Getting Started with Minerva for Human Activity Recognition</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/har_getting_started.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Getting-Started-with-Minerva-for-Human-Activity-Recognition">
<h1>Getting Started with Minerva for Human Activity Recognition<a class="headerlink" href="#Getting-Started-with-Minerva-for-Human-Activity-Recognition" title="Link to this heading">ïƒ</a></h1>
<p>Human Activity Recognition (HAR) is a challenging task that involves identifying actions performed by individuals based on sensor dataâ€”typically time-series signals from accelerometers and gyroscopes.</p>
<p>In this notebook, we will use Minerva to train and evaluate an <a class="reference external" href="https://ieeexplore.ieee.org/document/9771436">1D ResNet-SE</a> model from scratch for classifying human activities using <a class="reference external" href="https://www.nature.com/articles/s41597-024-03951-4">DAGHAR Dataset</a>.</p>
<p>Thus, this notebook is a step-by-step guide to get you started with Minerva for HAR. It comprehends the following steps:</p>
<ol class="arabic simple">
<li><p>Data Preparation</p></li>
<li><p>Model Creation</p></li>
<li><p>Model Training</p></li>
<li><p>Model Evaluation</p></li>
</ol>
<section id="Imports">
<h2>Imports<a class="headerlink" href="#Imports" title="Link to this heading">ïƒ</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lightning</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">L</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torchmetrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">Accuracy</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">minerva.data.readers.csv_reader</span><span class="w"> </span><span class="kn">import</span> <span class="n">CSVReader</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">minerva.data.datasets.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimpleDataset</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">minerva.data.data_modules.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">MinervaDataModule</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">minerva.models.nets.time_series.resnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">ResNetSE1D_5</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">minerva.transforms</span><span class="w"> </span><span class="kn">import</span> <span class="n">Reshape</span><span class="p">,</span> <span class="n">CastTo</span><span class="p">,</span> <span class="n">TransformPipeline</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.10/dist-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
</pre></div></div>
</div>
</section>
<section id="1.-Data-Preparation">
<h2>1. Data Preparation<a class="headerlink" href="#1.-Data-Preparation" title="Link to this heading">ïƒ</a></h2>
<p>We begin by preparing the data required for training and evaluation.</p>
<p>For this tutorial, we will use the <a class="reference external" href="https://zenodo.org/records/13987073">standardized view of the DAGHAR Dataset</a>, as introduced in the following paper:</p>
<div class="highlight-latex notranslate"><div class="highlight"><pre><span></span>Napoli, O., Duarte, D., Alves, P., Soto, D.H.P., de Oliveira, H.E., Rocha, A., Boccato, L. and Borin, E., 2024.
A benchmark for domain adaptation and generalization in smartphone-based human activity recognition.
Scientific Data, 11(1), p.1192.
</pre></div>
</div>
<p>This dataset includes time-series data from two tri-axial sensorsâ€”an accelerometer and a gyroscopeâ€”collected via smartphones. It is organized into six different datasets:</p>
<ul class="simple">
<li><p>KuHar</p></li>
<li><p>MotionSense</p></li>
<li><p>RealWorld-waist</p></li>
<li><p>RealWorld-thigh</p></li>
<li><p>UCI</p></li>
<li><p>WISDM</p></li>
</ul>
<p>In this notebook, we will work with the <strong>standardized view of the MotionSense</strong> dataset.</p>
<p>You can download and extract the dataset using the commands below (<code class="docutils literal notranslate"><span class="pre">wget</span></code> and <code class="docutils literal notranslate"><span class="pre">unzip</span></code>):</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>wget<span class="w"> </span>https://zenodo.org/records/13987073/files/standardized_view.zip?download<span class="o">=</span><span class="m">1</span><span class="w"> </span>-O<span class="w"> </span>daghar_standardized_view.zip
<span class="o">!</span>mkdir<span class="w"> </span>-p<span class="w"> </span>datasets/DAGHAR
<span class="o">!</span>unzip<span class="w"> </span>-o<span class="w"> </span>daghar_standardized_view.zip<span class="w"> </span>-d<span class="w"> </span>datasets/DAGHAR/
<span class="o">!</span>rm<span class="w"> </span>daghar_standardized_view.zip
</pre></div>
</div>
</div>
<p>Once extracted, the folder structure will look like this:</p>
<div class="highlight-tree notranslate"><div class="highlight"><pre><span></span>daghar_standardized_view/standardized_view
â”œâ”€â”€ KuHar
â”‚   â”œâ”€â”€ train.csv
â”‚   â”œâ”€â”€ test.csv
â”‚   â””â”€â”€ val.csv
â”œâ”€â”€ MotionSense
â”‚   â”œâ”€â”€ train.csv
â”‚   â”œâ”€â”€ test.csv
â”‚   â””â”€â”€ val.csv
â”œâ”€â”€ RealWorld_waist
â”‚   â”œâ”€â”€ train.csv
â”‚   â”œâ”€â”€ test.csv
â”‚   â””â”€â”€ val.csv
â”œâ”€â”€ RealWorld_thigh
â”‚   â”œâ”€â”€ train.csv
â”‚   â”œâ”€â”€ test.csv
â”‚   â””â”€â”€ val.csv
â”œâ”€â”€ UCI
â”‚   â”œâ”€â”€ train.csv
â”‚   â”œâ”€â”€ test.csv
â”‚   â””â”€â”€ val.csv
â””â”€â”€ WISDM
    â”œâ”€â”€ train.csv
    â”œâ”€â”€ test.csv
    â””â”€â”€ val.csv
</pre></div>
</div>
<p>Each dataset is split into <code class="docutils literal notranslate"><span class="pre">train.csv</span></code>, <code class="docutils literal notranslate"><span class="pre">val.csv</span></code>, and <code class="docutils literal notranslate"><span class="pre">test.csv</span></code> files. Each file contains time-series data with the following structure:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Column Range</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Pattern to match</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">accel-x-0</span></code> to <code class="docutils literal notranslate"><span class="pre">accel-x-59</span></code></p></td>
<td><p>60 time steps of accelerometer x-axis</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">accel-x-*</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">accel-y-0</span></code> to <code class="docutils literal notranslate"><span class="pre">accel-y-59</span></code></p></td>
<td><p>60 time steps of accelerometer y-axis</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">accel-y-*</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">accel-z-0</span></code> to <code class="docutils literal notranslate"><span class="pre">accel-z-59</span></code></p></td>
<td><p>60 time steps of accelerometer z-axis</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">accel-z-*</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">gyro-x-0</span></code> to <code class="docutils literal notranslate"><span class="pre">gyro-x-59</span></code></p></td>
<td><p>60 time steps of gyroscope x-axis</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">gyro-x-*</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">gyro-y-0</span></code> to <code class="docutils literal notranslate"><span class="pre">gyro-y-59</span></code></p></td>
<td><p>60 time steps of gyroscope y-axis</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">gyro-y-*</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">gyro-z-0</span></code> to <code class="docutils literal notranslate"><span class="pre">gyro-z-59</span></code></p></td>
<td><p>60 time steps of gyroscope z-axis</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">gyro-z-*</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">standard</span> <span class="pre">activity</span> <span class="pre">code</span></code></p></td>
<td><p>Encoded activity label</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">standard</span> <span class="pre">activity</span> <span class="pre">code</span></code></p></td>
</tr>
</tbody>
</table>
<p>Each row represents one sample, composed of 6 channels (3 from each sensor) and 60 time steps per channel, representing 3 seconds of data at a sampling rate of 20 Hz. The â€œPattern to matchâ€ column indicates the regex pattern used to identify the columns in the dataset.</p>
<p>All datasets in DAGHAR share the same structure and label set. The activity codes are mapped as follows:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Standard Activity Code</p></th>
<th class="head"><p>Activity</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>Sit</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>Stand</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>Walk</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>Stair-up</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>Stair-down</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>Run</p></td>
</tr>
</tbody>
</table>
<section id="1.1.-Creating-Data-Readers-and-Datasets">
<h3>1.1. Creating Data Readers and Datasets<a class="headerlink" href="#1.1.-Creating-Data-Readers-and-Datasets" title="Link to this heading">ïƒ</a></h3>
<p>In Minerva, we can create readers, which are responsible for loading a single unit of data in a ordered way. It is like an ordered iterator that loads data from a source. A dataset is a collection of readers and transforms associated to each reader. We will create two readers for each split of the dataset (train, validation, and test): the data reader and label reader. For this purpose, we will use <code class="docutils literal notranslate"><span class="pre">CSVReader</span></code> that loads data from CSV files, select the columns that match the regex patterns,
and reshape it to a format suitable for training.</p>
<p>The data reader requires the following parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code>: Path to the CSV file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">columns_to_select</span></code>: A list of regular expressions to select the columns from the CSV file, in order. In our case, we will use patterns indicated in the table above. Thus, we will select the columns that match the regex patterns <code class="docutils literal notranslate"><span class="pre">accel-x-*</span></code>, <code class="docutils literal notranslate"><span class="pre">accel-y-*</span></code>, <code class="docutils literal notranslate"><span class="pre">accel-z-*</span></code>, <code class="docutils literal notranslate"><span class="pre">gyro-x-*</span></code>, <code class="docutils literal notranslate"><span class="pre">gyro-y-*</span></code>, and <code class="docutils literal notranslate"><span class="pre">gyro-z-*</span></code>. This will give us a total of 360 columns (60 time steps * 6 channels), in order of pattern matched:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">accel-x-*</span></code>: 60 columns (<code class="docutils literal notranslate"><span class="pre">accel-x-0</span></code> to <code class="docutils literal notranslate"><span class="pre">accel-x-59</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">accel-y-*</span></code>: 60 columns (<code class="docutils literal notranslate"><span class="pre">accel-y-0</span></code> to <code class="docutils literal notranslate"><span class="pre">accel-y-59</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">accel-z-*</span></code>: 60 columns (<code class="docutils literal notranslate"><span class="pre">accel-z-0</span></code> to <code class="docutils literal notranslate"><span class="pre">accel-z-59</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gyro-x-*</span></code>: 60 columns (<code class="docutils literal notranslate"><span class="pre">gyro-x-0</span></code> to <code class="docutils literal notranslate"><span class="pre">gyro-x-59</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gyro-y-*</span></code>: 60 columns (<code class="docutils literal notranslate"><span class="pre">gyro-y-0</span></code> to <code class="docutils literal notranslate"><span class="pre">gyro-y-59</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gyro-z-*</span></code>: 60 columns (<code class="docutils literal notranslate"><span class="pre">gyro-z-0</span></code> to <code class="docutils literal notranslate"><span class="pre">gyro-z-59</span></code>)</p></li>
</ul>
</li>
</ul>
<p>The label reader requires the following parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code>: Path to the CSV file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">columns_to_select</span></code>: A single string indicating the column name to select. In our case, we will use <code class="docutils literal notranslate"><span class="pre">standard</span> <span class="pre">activity</span> <span class="pre">code</span></code>, which is the name of the column that contains the activity labels.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cast_to</span></code>: The data type of the labels. In our case, we will use <code class="docutils literal notranslate"><span class="pre">np.int64</span></code>, which is a 64-bit integer.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># train_reader</span>
<span class="n">root_data_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;datasets/DAGHAR/standardized_view/MotionSense/&quot;</span><span class="p">)</span>

<span class="c1"># Train data and label readers</span>
<span class="n">train_data_reader</span> <span class="o">=</span> <span class="n">CSVReader</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="n">root_data_dir</span> <span class="o">/</span> <span class="s2">&quot;train.csv&quot;</span><span class="p">,</span>
    <span class="n">columns_to_select</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accel-x-*&quot;</span><span class="p">,</span> <span class="s2">&quot;accel-y-*&quot;</span><span class="p">,</span> <span class="s2">&quot;accel-z-*&quot;</span><span class="p">,</span> <span class="s2">&quot;gyro-x-*&quot;</span><span class="p">,</span> <span class="s2">&quot;gyro-y-*&quot;</span><span class="p">,</span> <span class="s2">&quot;gyro-z-*&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">train_label_reader</span> <span class="o">=</span> <span class="n">CSVReader</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="n">root_data_dir</span> <span class="o">/</span> <span class="s2">&quot;train.csv&quot;</span><span class="p">,</span>
    <span class="n">columns_to_select</span><span class="o">=</span><span class="s2">&quot;standard activity code&quot;</span><span class="p">,</span>
    <span class="n">cast_to</span><span class="o">=</span><span class="s2">&quot;int64&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Validation data and label readers</span>
<span class="n">validation_data_reader</span> <span class="o">=</span> <span class="n">CSVReader</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="n">root_data_dir</span> <span class="o">/</span> <span class="s2">&quot;validation.csv&quot;</span><span class="p">,</span>
    <span class="n">columns_to_select</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accel-x-*&quot;</span><span class="p">,</span> <span class="s2">&quot;accel-y-*&quot;</span><span class="p">,</span> <span class="s2">&quot;accel-z-*&quot;</span><span class="p">,</span> <span class="s2">&quot;gyro-x-*&quot;</span><span class="p">,</span> <span class="s2">&quot;gyro-y-*&quot;</span><span class="p">,</span> <span class="s2">&quot;gyro-z-*&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">validation_label_reader</span> <span class="o">=</span> <span class="n">CSVReader</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="n">root_data_dir</span> <span class="o">/</span> <span class="s2">&quot;validation.csv&quot;</span><span class="p">,</span>
    <span class="n">columns_to_select</span><span class="o">=</span><span class="s2">&quot;standard activity code&quot;</span><span class="p">,</span>
    <span class="n">cast_to</span><span class="o">=</span><span class="s2">&quot;int64&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Test data and label readers</span>
<span class="n">test_data_reader</span> <span class="o">=</span> <span class="n">CSVReader</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="n">root_data_dir</span> <span class="o">/</span> <span class="s2">&quot;test.csv&quot;</span><span class="p">,</span>
    <span class="n">columns_to_select</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accel-x-*&quot;</span><span class="p">,</span> <span class="s2">&quot;accel-y-*&quot;</span><span class="p">,</span> <span class="s2">&quot;accel-z-*&quot;</span><span class="p">,</span> <span class="s2">&quot;gyro-x-*&quot;</span><span class="p">,</span> <span class="s2">&quot;gyro-y-*&quot;</span><span class="p">,</span> <span class="s2">&quot;gyro-z-*&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">test_label_reader</span> <span class="o">=</span> <span class="n">CSVReader</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="n">root_data_dir</span> <span class="o">/</span> <span class="s2">&quot;test.csv&quot;</span><span class="p">,</span>
    <span class="n">columns_to_select</span><span class="o">=</span><span class="s2">&quot;standard activity code&quot;</span><span class="p">,</span>
    <span class="n">cast_to</span><span class="o">=</span><span class="s2">&quot;int64&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Train data reader length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_data_reader</span><span class="p">)</span><span class="si">}</span><span class="s2">; Label reader length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_label_reader</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation data reader length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">validation_data_reader</span><span class="p">)</span><span class="si">}</span><span class="s2">; Label reader length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">validation_label_reader</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test data reader length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">test_data_reader</span><span class="p">)</span><span class="si">}</span><span class="s2">; Label reader length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">test_label_reader</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Train data reader length: 3558; Label reader length: 3558
Validation data reader length: 420; Label reader length: 420
Test data reader length: 1062; Label reader length: 1062
</pre></div></div>
</div>
<p>Once the readers are set up, we can create a dataset using them. For this purpose, weâ€™ll use the <code class="docutils literal notranslate"><span class="pre">SimpleDataset</span></code> class, which takes two main inputs:</p>
<ul class="simple">
<li><p>A list of <strong>readers</strong> (data sources)</p></li>
<li><p>A list of <strong>transforms</strong> (optional preprocessing steps)</p></li>
</ul>
<p>When an item at index <code class="docutils literal notranslate"><span class="pre">i</span></code> is requested from the dataset (e.g., <code class="docutils literal notranslate"><span class="pre">dataset[i]</span></code>), the following steps occur:</p>
<ol class="arabic simple">
<li><p>The dataset retrieves the item at index <code class="docutils literal notranslate"><span class="pre">i</span></code> from <code class="docutils literal notranslate"><span class="pre">reader[0]</span></code> and applies the corresponding transform <code class="docutils literal notranslate"><span class="pre">transform[0]</span></code> (if any).</p></li>
<li><p>It then retrieves the item at index <code class="docutils literal notranslate"><span class="pre">i</span></code> from <code class="docutils literal notranslate"><span class="pre">reader[1]</span></code> and applies <code class="docutils literal notranslate"><span class="pre">transform[1]</span></code> (if any).</p></li>
<li><p>Finally, it returns a 2-element tuple containing the transformed outputs:</p>
<ul class="simple">
<li><p>The first element is data: <code class="docutils literal notranslate"><span class="pre">transform[0](reader[0][i])</span></code></p></li>
<li><p>The second element is label: <code class="docutils literal notranslate"><span class="pre">transform[1](reader[1][i])</span></code></p></li>
</ul>
</li>
</ol>
<p>This design enables flexible and consistent pairing of multiple data sources with their corresponding preprocessing logic-ideal for training, validation, or testing workflows.</p>
<p>As transformation, we will use <code class="docutils literal notranslate"><span class="pre">Reshape</span></code> to reshape the data to the format required by the model, in our case <code class="docutils literal notranslate"><span class="pre">(6,</span> <span class="pre">60)</span></code>, which means 6 channels (3 from each sensor) and 60 time steps per channel. We also use a <code class="docutils literal notranslate"><span class="pre">CastTo</span></code> transform to cast the data to <code class="docutils literal notranslate"><span class="pre">np.float32</span></code>, which is the data type required by the model and labels to <code class="docutils literal notranslate"><span class="pre">np.int64</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">SimpleDataset</span><span class="p">(</span>
    <span class="n">readers</span><span class="o">=</span><span class="p">[</span>
        <span class="n">train_data_reader</span><span class="p">,</span>  <span class="c1"># Reader for the data</span>
        <span class="n">train_label_reader</span>  <span class="c1"># Reader for the labels</span>
    <span class="p">],</span>
    <span class="n">transforms</span><span class="o">=</span><span class="p">[</span>
        <span class="n">TransformPipeline</span><span class="p">([</span><span class="n">Reshape</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">60</span><span class="p">)),</span> <span class="n">CastTo</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)]),</span>   <span class="c1"># Transforms to apply to the data</span>
        <span class="n">CastTo</span><span class="p">(</span><span class="s2">&quot;int64&quot;</span><span class="p">)</span>                                             <span class="c1"># Cast the labels to int64</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">val_dataset</span> <span class="o">=</span> <span class="n">SimpleDataset</span><span class="p">(</span>
    <span class="n">readers</span><span class="o">=</span><span class="p">[</span>
        <span class="n">validation_data_reader</span><span class="p">,</span>
        <span class="n">validation_label_reader</span>
    <span class="p">],</span>
    <span class="n">transforms</span><span class="o">=</span><span class="p">[</span>
        <span class="n">TransformPipeline</span><span class="p">([</span><span class="n">Reshape</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">60</span><span class="p">)),</span> <span class="n">CastTo</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)]),</span>   <span class="c1"># Transforms to apply to the data</span>
        <span class="n">CastTo</span><span class="p">(</span><span class="s2">&quot;int64&quot;</span><span class="p">)</span>                                             <span class="c1"># Cast the labels to int64</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">SimpleDataset</span><span class="p">(</span>
    <span class="n">readers</span><span class="o">=</span><span class="p">[</span><span class="n">test_data_reader</span><span class="p">,</span> <span class="n">test_label_reader</span><span class="p">],</span>
    <span class="n">transforms</span><span class="o">=</span><span class="p">[</span>
        <span class="n">TransformPipeline</span><span class="p">([</span><span class="n">Reshape</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">60</span><span class="p">)),</span> <span class="n">CastTo</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)]),</span>   <span class="c1"># Transforms to apply to the data</span>
        <span class="n">CastTo</span><span class="p">(</span><span class="s2">&quot;int64&quot;</span><span class="p">)</span>                                             <span class="c1"># Cast the labels to int64</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Train dataset</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">train_dataset</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation dataset</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">val_dataset</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test dataset</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">test_dataset</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Train dataset
 ==================================================
           ğŸ“‚ SimpleDataset Information
==================================================
ğŸ“Œ Dataset Type: SimpleDataset
   â””â”€â”€ Reader 0: TabularReader(df=(3558, 728), columns_to_select=[&#39;accel-x-*&#39;, &#39;accel-y-*&#39;, &#39;accel-z-*&#39;, &#39;gyro-x-*&#39;, &#39;gyro-y-*&#39;, &#39;gyro-z-*&#39;], cast_to=None, data_shape=None)
   â”‚     â””â”€â”€ Transform: TransformPipeline(transforms=[Reshape(shape=(6, 60)), CastTo(dtype=float32)])
   â””â”€â”€ Reader 1: TabularReader(df=(3558, 728), columns_to_select=[&#39;standard activity code&#39;], cast_to=int64, data_shape=None)
   â”‚     â””â”€â”€ Transform: CastTo(dtype=int64)
   â”‚
   â””â”€â”€ Total Readers: 2
==================================================

Validation dataset
 ==================================================
           ğŸ“‚ SimpleDataset Information
==================================================
ğŸ“Œ Dataset Type: SimpleDataset
   â””â”€â”€ Reader 0: TabularReader(df=(420, 728), columns_to_select=[&#39;accel-x-*&#39;, &#39;accel-y-*&#39;, &#39;accel-z-*&#39;, &#39;gyro-x-*&#39;, &#39;gyro-y-*&#39;, &#39;gyro-z-*&#39;], cast_to=None, data_shape=None)
   â”‚     â””â”€â”€ Transform: TransformPipeline(transforms=[Reshape(shape=(6, 60)), CastTo(dtype=float32)])
   â””â”€â”€ Reader 1: TabularReader(df=(420, 728), columns_to_select=[&#39;standard activity code&#39;], cast_to=int64, data_shape=None)
   â”‚     â””â”€â”€ Transform: CastTo(dtype=int64)
   â”‚
   â””â”€â”€ Total Readers: 2
==================================================

Test dataset
 ==================================================
           ğŸ“‚ SimpleDataset Information
==================================================
ğŸ“Œ Dataset Type: SimpleDataset
   â””â”€â”€ Reader 0: TabularReader(df=(1062, 728), columns_to_select=[&#39;accel-x-*&#39;, &#39;accel-y-*&#39;, &#39;accel-z-*&#39;, &#39;gyro-x-*&#39;, &#39;gyro-y-*&#39;, &#39;gyro-z-*&#39;], cast_to=None, data_shape=None)
   â”‚     â””â”€â”€ Transform: TransformPipeline(transforms=[Reshape(shape=(6, 60)), CastTo(dtype=float32)])
   â””â”€â”€ Reader 1: TabularReader(df=(1062, 728), columns_to_select=[&#39;standard activity code&#39;], cast_to=int64, data_shape=None)
   â”‚     â””â”€â”€ Transform: CastTo(dtype=int64)
   â”‚
   â””â”€â”€ Total Readers: 2
==================================================

</pre></div></div>
</div>
<p>Letâ€™s take a look at the first sample of the training dataset. As each sample has 6 channels and 60 time steps, the shape of the sample will be <code class="docutils literal notranslate"><span class="pre">(6,</span> <span class="pre">60)</span></code>. The label will be a single integer representing the activity code. We can visualize the data using <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> to get an idea of what the data looks like.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_X</span><span class="p">,</span> <span class="n">sample_y</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="mi">800</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The shape of the input is </span><span class="si">{</span><span class="n">sample_X</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> and the label is </span><span class="si">{</span><span class="n">sample_y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">activity_labels</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;Sit&quot;</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;Stand&quot;</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;Walk&quot;</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;Stair-up&quot;</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s2">&quot;Stair-down&quot;</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="s2">&quot;Run&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">activity</span> <span class="o">=</span> <span class="n">activity_labels</span><span class="p">[</span><span class="n">sample_y</span><span class="p">]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Activity: </span><span class="si">{</span><span class="n">activity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="c1"># Accelerometer subplot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># plt.subptitle(f&quot;Activity: {activity}&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sample_X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sample_X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sample_X</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accelerometer&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Sensor value (m/s^2)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Gyroscope subplot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sample_X</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sample_X</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sample_X</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gyroscope&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Sensor value (rad/s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The shape of the input is (6, 60) and the label is 5
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_har_getting_started_12_1.png" src="../_images/notebooks_har_getting_started_12_1.png" />
</div>
</div>
</section>
<section id="1.2.-Creating-the-MinervaDataModule">
<h3>1.2. Creating the <code class="docutils literal notranslate"><span class="pre">MinervaDataModule</span></code><a class="headerlink" href="#1.2.-Creating-the-MinervaDataModule" title="Link to this heading">ïƒ</a></h3>
<p>Minerva models are implemented using Pytorch Lightning. Thus, to train a model we should create a <code class="docutils literal notranslate"><span class="pre">LightningDataModule</span></code> object that will handle the data loading and preprocessing. Minerva provides a <code class="docutils literal notranslate"><span class="pre">MinervaDataModule</span></code> class that extends Pytorch Lightningâ€™s <code class="docutils literal notranslate"><span class="pre">LightningDataModule</span></code> class and standardizes the data loading process.</p>
<p>We may create a <code class="docutils literal notranslate"><span class="pre">MinervaDataModule</span></code> object by passing the training, validation, and testing datasets, as well as the batch size and the number of workers for data loading</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_module</span> <span class="o">=</span> <span class="n">MinervaDataModule</span><span class="p">(</span>
    <span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span>
    <span class="n">val_dataset</span><span class="o">=</span><span class="n">val_dataset</span><span class="p">,</span>
    <span class="n">test_dataset</span><span class="o">=</span><span class="n">test_dataset</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;MotionSense Dataset&quot;</span><span class="p">,</span>
    <span class="n">num_workers</span><span class="o">=</span><span class="mi">4</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">data_module</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
==================================================
               ğŸ†” MotionSense Dataset
==================================================
â””â”€â”€ Predict Split: test
ğŸ“‚ Datasets:
   â”œâ”€â”€ Train Dataset:
   â”‚      ==================================================
   â”‚                 ğŸ“‚ SimpleDataset Information
   â”‚      ==================================================
   â”‚      ğŸ“Œ Dataset Type: SimpleDataset
   â”‚         â””â”€â”€ Reader 0: TabularReader(df=(3558, 728), columns_to_select=[&#39;accel-x-*&#39;, &#39;accel-y-*&#39;, &#39;accel-z-*&#39;, &#39;gyro-x-*&#39;, &#39;gyro-y-*&#39;, &#39;gyro-z-*&#39;], cast_to=None, data_shape=None)
   â”‚         â”‚     â””â”€â”€ Transform: TransformPipeline(transforms=[Reshape(shape=(6, 60)), CastTo(dtype=float32)])
   â”‚         â””â”€â”€ Reader 1: TabularReader(df=(3558, 728), columns_to_select=[&#39;standard activity code&#39;], cast_to=int64, data_shape=None)
   â”‚         â”‚     â””â”€â”€ Transform: CastTo(dtype=int64)
   â”‚         â”‚
   â”‚         â””â”€â”€ Total Readers: 2
   â”‚      ==================================================
   â”œâ”€â”€ Val Dataset:
   â”‚      ==================================================
   â”‚                 ğŸ“‚ SimpleDataset Information
   â”‚      ==================================================
   â”‚      ğŸ“Œ Dataset Type: SimpleDataset
   â”‚         â””â”€â”€ Reader 0: TabularReader(df=(420, 728), columns_to_select=[&#39;accel-x-*&#39;, &#39;accel-y-*&#39;, &#39;accel-z-*&#39;, &#39;gyro-x-*&#39;, &#39;gyro-y-*&#39;, &#39;gyro-z-*&#39;], cast_to=None, data_shape=None)
   â”‚         â”‚     â””â”€â”€ Transform: TransformPipeline(transforms=[Reshape(shape=(6, 60)), CastTo(dtype=float32)])
   â”‚         â””â”€â”€ Reader 1: TabularReader(df=(420, 728), columns_to_select=[&#39;standard activity code&#39;], cast_to=int64, data_shape=None)
   â”‚         â”‚     â””â”€â”€ Transform: CastTo(dtype=int64)
   â”‚         â”‚
   â”‚         â””â”€â”€ Total Readers: 2
   â”‚      ==================================================
   â””â”€â”€ Test Dataset:
          ==================================================
                     ğŸ“‚ SimpleDataset Information
          ==================================================
          ğŸ“Œ Dataset Type: SimpleDataset
             â””â”€â”€ Reader 0: TabularReader(df=(1062, 728), columns_to_select=[&#39;accel-x-*&#39;, &#39;accel-y-*&#39;, &#39;accel-z-*&#39;, &#39;gyro-x-*&#39;, &#39;gyro-y-*&#39;, &#39;gyro-z-*&#39;], cast_to=None, data_shape=None)
             â”‚     â””â”€â”€ Transform: TransformPipeline(transforms=[Reshape(shape=(6, 60)), CastTo(dtype=float32)])
             â””â”€â”€ Reader 1: TabularReader(df=(1062, 728), columns_to_select=[&#39;standard activity code&#39;], cast_to=int64, data_shape=None)
             â”‚     â””â”€â”€ Transform: CastTo(dtype=int64)
             â”‚
             â””â”€â”€ Total Readers: 2
          ==================================================

ğŸ›  **Dataloader Configurations:**
   â”œâ”€â”€ Dataloader class: &lt;class &#39;torch.utils.data.dataloader.DataLoader&#39;&gt;
   â”œâ”€â”€ Train Dataloader Kwargs:
         â”œâ”€â”€ batch_size: 64
         â”œâ”€â”€ num_workers: 4
         â”œâ”€â”€ shuffle: true
         â”œâ”€â”€ drop_last: false
   â”œâ”€â”€ Val Dataloader Kwargs:
         â”œâ”€â”€ batch_size: 64
         â”œâ”€â”€ num_workers: 4
         â”œâ”€â”€ shuffle: false
         â”œâ”€â”€ drop_last: false
   â””â”€â”€ Test Dataloader Kwargs:
         â”œâ”€â”€ batch_size: 64
         â”œâ”€â”€ num_workers: 4
         â”œâ”€â”€ shuffle: false
         â”œâ”€â”€ drop_last: false
==================================================
</pre></div></div>
</div>
</section>
</section>
<section id="2.-Creating-the-Model">
<h2>2. Creating the Model<a class="headerlink" href="#2.-Creating-the-Model" title="Link to this heading">ïƒ</a></h2>
<p>Minerva provides several models to be used in Human Activity Recognition. In this notebook we will use the <code class="docutils literal notranslate"><span class="pre">`ResNetSE1D_5</span></code> model &lt;<a class="reference external" href="https://ieeexplore.ieee.org/document/9771436">https://ieeexplore.ieee.org/document/9771436</a>&gt;`__ which is a 1D ResNet model with Squeeze-and-Excitation blocks and 5 residual blocks.</p>
<p>To create the model, we just need to call the <code class="docutils literal notranslate"><span class="pre">ResNetSE1D_5</span></code> class from Minerva and pass the following parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">input_shape</span></code>: Shape of each input samples, in the format <code class="docutils literal notranslate"><span class="pre">(channels,</span> <span class="pre">time_steps)</span></code>. In this case, it will be <code class="docutils literal notranslate"><span class="pre">(6,</span> <span class="pre">60)</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_classes</span></code>: Number of classes in the dataset. In this case, it will be 6.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">ResNetSE1D_5</span><span class="p">(</span>
    <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span>
    <span class="n">num_classes</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">model</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
[W519 00:56:43.921873382 NNPACK.cpp:57] Could not initialize NNPACK! Reason: Unsupported hardware.
[W519 00:56:43.924887388 NNPACK.cpp:57] Could not initialize NNPACK! Reason: Unsupported hardware.
[W519 00:56:43.926286206 NNPACK.cpp:57] Could not initialize NNPACK! Reason: Unsupported hardware.
[W519 00:56:43.927542423 NNPACK.cpp:57] Could not initialize NNPACK! Reason: Unsupported hardware.
[W519 00:56:43.928236215 NNPACK.cpp:57] Could not initialize NNPACK! Reason: Unsupported hardware.
[W519 00:56:43.929310238 NNPACK.cpp:57] Could not initialize NNPACK! Reason: Unsupported hardware.
[W519 00:56:43.929749328 NNPACK.cpp:57] Could not initialize NNPACK! Reason: Unsupported hardware.
[W519 00:56:43.930615444 NNPACK.cpp:57] Could not initialize NNPACK! Reason: Unsupported hardware.
[W519 00:56:43.931039904 NNPACK.cpp:57] Could not initialize NNPACK! Reason: Unsupported hardware.
[W519 00:56:43.931915372 NNPACK.cpp:57] Could not initialize NNPACK! Reason: Unsupported hardware.
[W519 00:56:43.932344124 NNPACK.cpp:57] Could not initialize NNPACK! Reason: Unsupported hardware.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ResNetSE1D_5(
  (backbone): _ResNet1D(
    (conv_block): ConvolutionalBlock(
      (block): Sequential(
        (0): Conv1d(6, 64, kernel_size=(5,), stride=(1,))
        (1): BatchNorm1d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
        (2): ReLU()
        (3): MaxPool1d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)
      )
    )
    (residual_blocks): Sequential(
      (0): ResNetSEBlock(
        (block): Sequential(
          (0): Conv1d(64, 32, kernel_size=(5,), stride=(1,), padding=same)
          (1): BatchNorm1d(32, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
          (2): ReLU()
          (3): Conv1d(32, 64, kernel_size=(5,), stride=(1,), padding=same)
          (4): BatchNorm1d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
          (5): SqueezeAndExcitation1D(
            (block): Sequential(
              (0): Linear(in_features=64, out_features=32, bias=True)
              (1): ReLU()
              (2): Linear(in_features=32, out_features=64, bias=True)
              (3): Sigmoid()
            )
          )
        )
      )
      (1): ResNetSEBlock(
        (block): Sequential(
          (0): Conv1d(64, 32, kernel_size=(5,), stride=(1,), padding=same)
          (1): BatchNorm1d(32, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
          (2): ReLU()
          (3): Conv1d(32, 64, kernel_size=(5,), stride=(1,), padding=same)
          (4): BatchNorm1d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
          (5): SqueezeAndExcitation1D(
            (block): Sequential(
              (0): Linear(in_features=64, out_features=32, bias=True)
              (1): ReLU()
              (2): Linear(in_features=32, out_features=64, bias=True)
              (3): Sigmoid()
            )
          )
        )
      )
      (2): ResNetSEBlock(
        (block): Sequential(
          (0): Conv1d(64, 32, kernel_size=(5,), stride=(1,), padding=same)
          (1): BatchNorm1d(32, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
          (2): ReLU()
          (3): Conv1d(32, 64, kernel_size=(5,), stride=(1,), padding=same)
          (4): BatchNorm1d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
          (5): SqueezeAndExcitation1D(
            (block): Sequential(
              (0): Linear(in_features=64, out_features=32, bias=True)
              (1): ReLU()
              (2): Linear(in_features=32, out_features=64, bias=True)
              (3): Sigmoid()
            )
          )
        )
      )
      (3): ResNetSEBlock(
        (block): Sequential(
          (0): Conv1d(64, 32, kernel_size=(5,), stride=(1,), padding=same)
          (1): BatchNorm1d(32, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
          (2): ReLU()
          (3): Conv1d(32, 64, kernel_size=(5,), stride=(1,), padding=same)
          (4): BatchNorm1d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
          (5): SqueezeAndExcitation1D(
            (block): Sequential(
              (0): Linear(in_features=64, out_features=32, bias=True)
              (1): ReLU()
              (2): Linear(in_features=32, out_features=64, bias=True)
              (3): Sigmoid()
            )
          )
        )
      )
      (4): ResNetSEBlock(
        (block): Sequential(
          (0): Conv1d(64, 32, kernel_size=(5,), stride=(1,), padding=same)
          (1): BatchNorm1d(32, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
          (2): ReLU()
          (3): Conv1d(32, 64, kernel_size=(5,), stride=(1,), padding=same)
          (4): BatchNorm1d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
          (5): SqueezeAndExcitation1D(
            (block): Sequential(
              (0): Linear(in_features=64, out_features=32, bias=True)
              (1): ReLU()
              (2): Linear(in_features=32, out_features=64, bias=True)
              (3): Sigmoid()
            )
          )
        )
      )
    )
    (global_avg_pool): AdaptiveAvgPool1d(output_size=1)
  )
  (fc): Linear(in_features=64, out_features=6, bias=True)
  (loss_fn): CrossEntropyLoss()
)
</pre></div></div>
</div>
</section>
<section id="3.-Defining-the-trainer">
<h2>3. Defining the trainer<a class="headerlink" href="#3.-Defining-the-trainer" title="Link to this heading">ïƒ</a></h2>
<p>As we are using Pytorch Lightning, we need to define a <code class="docutils literal notranslate"><span class="pre">Trainer</span></code> object to train the model. We can define the trainer by passing the following parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">max_epochs</span></code>: Maximum number of epochs to train the model.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">acceleartor</span></code>: Device to use for training. It can be <code class="docutils literal notranslate"><span class="pre">cpu</span></code> or <code class="docutils literal notranslate"><span class="pre">gpu</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">devices</span></code>: the list or the number of accelerator to use for training.</p></li>
</ul>
<p>For this example we will disable logging and checkpointing, by setting <code class="docutils literal notranslate"><span class="pre">logger=False</span></code> and <code class="docutils literal notranslate"><span class="pre">checkpoint_callback=False</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trainer</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">Trainer</span><span class="p">(</span>
    <span class="n">max_epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">devices</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">accelerator</span><span class="o">=</span><span class="s2">&quot;gpu&quot;</span><span class="p">,</span>
    <span class="n">logger</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">enable_checkpointing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
HPU available: False, using: 0 HPUs
</pre></div></div>
</div>
</section>
<section id="3.1.-Training-the-model">
<h2>3.1. Training the model<a class="headerlink" href="#3.1.-Training-the-model" title="Link to this heading">ïƒ</a></h2>
<p>To train the model we need to have three objects: the model, the data module, and the trainer. We can train the model by calling the <code class="docutils literal notranslate"><span class="pre">fit</span></code> method from the trainer and passing the model and the data module.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">fit</span></code> method will train the model for the number of epochs defined in the trainer object. Also, training dataloader will be used for training, and validation dataloader will be used for validation.</p>
<blockquote>
<div><p><strong>NOTE</strong>: We are not saving the model checkpoints in this example and not using early stopping based on validation loss. Thus, the model from last checkpoint will be used for evaluation. This may cause overfitting if the model is trained for too many epochs.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data_module</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]

  | Name     | Type             | Params | Mode
------------------------------------------------------
0 | backbone | _ResNet1D        | 126 K  | train
1 | fc       | Linear           | 390    | train
2 | loss_fn  | CrossEntropyLoss | 0      | train
------------------------------------------------------
127 K     Trainable params
0         Non-trainable params
127 K     Total params
0.509     Total estimated model params size (MB)
76        Modules in train mode
0         Modules in eval mode
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/vscode/.local/lib/python3.10/site-packages/lightning/pytorch/core/module.py:512: You called `self.log(&#39;val_loss&#39;, ..., logger=True)` but have no logger configured. You can enable one by doing `Trainer(logger=ALogger(...))`
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Epoch 0:   2%|â–         | 1/56 [00:00&lt;00:50,  1.09it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/vscode/.local/lib/python3.10/site-packages/lightning/pytorch/core/module.py:512: You called `self.log(&#39;train_loss&#39;, ..., logger=True)` but have no logger configured. You can enable one by doing `Trainer(logger=ALogger(...))`
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Epoch 99: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 56/56 [00:08&lt;00:00,  6.53it/s, val_loss=3.410, train_loss=0.0357]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
`Trainer.fit` stopped: `max_epochs=100` reached.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Epoch 99: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 56/56 [00:08&lt;00:00,  6.52it/s, val_loss=3.410, train_loss=0.0357]
</pre></div></div>
</div>
</section>
<section id="4.-Evaluating-Model">
<h2>4. Evaluating Model<a class="headerlink" href="#4.-Evaluating-Model" title="Link to this heading">ïƒ</a></h2>
<p>Once model is trained, we can evaluate the performance of the model on the test dataset. The performance is evaluated using the accuracy metric. To evaluate the model, we perform the following steps:</p>
<ol class="arabic simple">
<li><p>Perform inference on the test dataset using the trained model. This is done using the <code class="docutils literal notranslate"><span class="pre">trainer.predict</span></code> method. The method returns the predicted logits for each sample in the test dataset.</p></li>
<li><p>Calculate the predicted labels by taking the argmax of the logits.</p></li>
<li><p>Obtain the labels from the test dataset.</p></li>
<li><p>Create the accuracy metric object and pass the predicted labels and the true labels.</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Obtain predictions for the test set</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data_module</span><span class="p">)</span>
<span class="c1"># As predictions is a list of batches, we concatenate them along the first dimension</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># type: ignore</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Predicting DataLoader 0: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 17/17 [00:01&lt;00:00, 11.43it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2. We an use the torch.argmax function to obtain the class with the highest probability</span>
<span class="n">predicted_classes</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># type: ignore</span>
<span class="c1"># Let&#39;s print the predicted classes</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The shape of the predicted labels is </span><span class="si">{</span><span class="n">predicted_classes</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> and dtype </span><span class="si">{</span><span class="n">predicted_classes</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The shape of the predicted labels is torch.Size([1062]) and dtype torch.int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3. Let&#39;s obtain the true labels</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># We can use the test_dataset to obtain all the true labels</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_module</span><span class="o">.</span><span class="n">test_dataset</span><span class="p">)):</span>       <span class="c1"># type: ignore</span>
    <span class="n">sample_x</span><span class="p">,</span> <span class="n">sample_y</span> <span class="o">=</span> <span class="n">data_module</span><span class="o">.</span><span class="n">test_dataset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="c1"># type: ignore</span>
    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample_y</span><span class="p">)</span> <span class="c1"># type: ignore</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<span class="c1"># Let&#39;s print the true labels</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The shape of the true labels is </span><span class="si">{</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> and dtype </span><span class="si">{</span><span class="n">y</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The shape of the true labels is torch.Size([1062]) and dtype torch.int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 4. Let&#39;s create the accuracy metric object and compute the accuracy</span>
<span class="n">acc_metric</span> <span class="o">=</span> <span class="n">Accuracy</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s2">&quot;multiclass&quot;</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">acc_metric</span><span class="p">(</span><span class="n">predicted_classes</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The accuracy of the model is </span><span class="si">{</span><span class="n">score</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The accuracy of the model is 78.44%
</pre></div></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="seismic_facies_getting_started.html" class="btn btn-neutral float-left" title="Getting Started with Minerva for Seismic Facies Segmentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="experiment_api_example.html" class="btn btn-neutral float-right" title="Minerva Experimental Pipeline" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Unicamp.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>